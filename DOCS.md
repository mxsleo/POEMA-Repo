# Документация

## Карта сети

![Карта сети](/res/map.png)

## Описание проблемы

Требуется наладить стабильный канал связи между ```moskow-srv1``` и ```rostov-srv1```.

## Решение

### Диагностика сети

Первым этапом была выполнена диагностика сети. При помощи утилиты MTR было выявлено отсутствие связности между подсетями, причём сигнал от ```moskow-srv1``` достигал маршрутизатора ```mx-rnd-br1``` (последним адресом в таблице маршрутизации был 198.18.255.1/31), а маршрут от ```rostov-srv1``` не отображался.

### Решение проблемы связности подсетей

Диагностика позволила предположить, что в настройках маршрутизатора ```mx-rnd-br1``` содержится ошибка. И действительно, сравнение его конфигурации с симметричным ```mx-msk-br1``` позволило выявить политику, отсутствие которой не позволяло передавать данные по протоколу BGP. Исправление данной ошибки позволило установить связь между компьютерами.

[commit f47e58f](https://github.com/mxsleo/POEMA-Repo/commit/f47e58fc48251653fbbf75ea72ebeba9213a6fb1)

### Промежуточное исправление MTU в подсети

Поскольку траффик оставался нестабильным, требовалось принятие дальнейших решений. Изучение конфигураций маршрутизаторов выявило разницу в минимальных размерах пактов данных в пределах одной подсети на интерфейсах ```ge-0/0/0``` и ```ge-0/0/1``` ```mx-rnd-br4```, что не является корректным. Данный недостаток был устранён.

[commit a1bce05](https://github.com/mxsleo/POEMA-Repo/commit/a1bce0562c14219e3bb6cf177b98da818653fcc8)

### Финальная стабилизация соединения

Изучение таблиц маршрутизации и потерь на каждом из участков сети позволило предположить, что соединения между некоторыми из маршрутизаторов нестабильны, а именно между ```mx-msk-br4``` и ```mx-msk-br2``` и ```mx-rnd-br4``` и ```mx-rnd-br1```. Самым простым и логичным решением оказалась настройка метрики - значения, ипользуемого для выбора маршрута в сети. Были увеличены метрики нестабильных маршрутов и уменьшены метрики стабильных маршрутов, что и позволило добиться стабильности соединения.

[commit aa5507a](https://github.com/mxsleo/POEMA-Repo/commit/aa5507a51b07e20eaa5a1cb912b56b4c01e1909e)

[commit 67f33bd](https://github.com/mxsleo/POEMA-Repo/commit/67f33bd106cede7cd793c3019d608b82f33081f6)

![Карта стабильности](/res/broken.png)
